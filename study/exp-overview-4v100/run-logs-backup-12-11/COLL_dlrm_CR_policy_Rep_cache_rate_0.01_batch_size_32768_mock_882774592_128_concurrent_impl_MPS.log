[INFO] hierarchical_parameter_server is imported
[INFO]: sparse_operation_kit is imported
config:eval_tsp="2022-12-11 18:23:06"
config:gpu_num=4
config:iter_num=3000
config:slot_num=26
config:embed_vec_size=128
config:dense_dim=13
config:global_batch_size=32768
config:iteration_per_epoch=1000
config:coll_cache_enable_iter=1000
config:coll_cache_policy=rep
config:embed_only=False
config:model=dlrm
config:combiner=mean
config:optimizer=plugin_adam
config:np_key_type=<class 'numpy.int32'>
config:np_vector_type=<class 'numpy.float32'>
config:tf_key_type=<dtype: 'int32'>
config:tf_vector_type=<dtype: 'float32'>
config:ps_config_file=run-configs/COLL_dlrm_CR_policy_Rep_cache_rate_0.01_batch_size_32768_mock_882774585_128_concurrent_impl_MPS.json
config:dense_model_path=plain
config:dataset_path=/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
config:random_request=False
config:alpha=None
config:max_vocabulary_size=882774585
=====================================================HPS Parse====================================================
[HCTR][18:23:14.256][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:23:14.256][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:23:14.256][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:23:14.256][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:23:14.257][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:23:14.257][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:23:14.257][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:23:14.257][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:23:14.257][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:23:14.257][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:23:14.257][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:23:14.257][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:23:14.257][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:23:14.257][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:23:14.257][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:23:14.257][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:23:14.257][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:23:14.257][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:23:14.257][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:23:14.257][DEBUG][RK0][main]: Created raw model loader in local memory!
=====================================================HPS Parse====================================================
[HCTR][18:23:14.273][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:23:14.273][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:23:14.273][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:23:14.273][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:23:14.273][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:23:14.273][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:23:14.273][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:23:14.273][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:23:14.273][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:23:14.273][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:23:14.273][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:23:14.273][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:23:14.273][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:23:14.273][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:23:14.273][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:23:14.273][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:23:14.273][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:23:14.273][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:23:14.273][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:23:14.273][DEBUG][RK0][main]: Created raw model loader in local memory!
=====================================================HPS Parse====================================================
[HCTR][18:23:14.307][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:23:14.307][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:23:14.307][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:23:14.307][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:23:14.307][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:23:14.307][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:23:14.307][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:23:14.307][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:23:14.307][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:23:14.307][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:23:14.307][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:23:14.307][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:23:14.307][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:23:14.307][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:23:14.307][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:23:14.307][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:23:14.307][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:23:14.307][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:23:14.307][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:23:14.308][DEBUG][RK0][main]: Created raw model loader in local memory!
=====================================================HPS Parse====================================================
[HCTR][18:23:14.323][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:23:14.323][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:23:14.323][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:23:14.323][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:23:14.323][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:23:14.323][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:23:14.323][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:23:14.323][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:23:14.323][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:23:14.323][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:23:14.323][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:23:14.323][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:23:14.324][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:23:14.324][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:23:14.324][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:23:14.324][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:23:14.324][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:23:14.324][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:23:14.324][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:23:14.324][DEBUG][RK0][main]: Created raw model loader in local memory!
[HCTR][18:23:15.646][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:23:15.646][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:23:15.646][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:23:15.646][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:23:15.646][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:23:15.646][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:23:15.646][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:23:15.646][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:23:15.646][INFO][RK0][main]: Creating embedding cache in device 2.
[HCTR][18:23:15.646][INFO][RK0][main]: Creating embedding cache in device 0.
[HCTR][18:23:15.646][INFO][RK0][main]: Creating embedding cache in device 1.
[HCTR][18:23:15.646][INFO][RK0][main]: Creating embedding cache in device 3.
[HCTR][18:23:15.656][INFO][RK0][main]: Model name: dlrm
[HCTR][18:23:15.656][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:23:15.656][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:23:15.656][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:23:15.656][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:23:15.656][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:23:15.656][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:23:15.656][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:23:15.656][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:23:15.656][INFO][RK0][main]: Model name: dlrm
[HCTR][18:23:15.656][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:23:15.656][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:23:15.656][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:23:15.656][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:23:15.656][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:23:15.656][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:23:15.656][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:23:15.656][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:23:15.658][INFO][RK0][main]: Model name: dlrm
[HCTR][18:23:15.658][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:23:15.658][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:23:15.658][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:23:15.658][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:23:15.658][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:23:15.658][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:23:15.658][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:23:15.658][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:23:15.690][INFO][RK0][main]: Model name: dlrm
[HCTR][18:23:15.690][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:23:15.690][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:23:15.690][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:23:15.690][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:23:15.690][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:23:15.690][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:23:15.690][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:23:15.690][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:23:27.556][INFO][RK0][main]: Creating lookup session for dlrm on device: 3
[HCTR][18:23:27.557][INFO][RK0][main]: Creating lookup session for dlrm on device: 2
[HCTR][18:23:27.564][INFO][RK0][main]: Creating lookup session for dlrm on device: 0
[HCTR][18:23:27.576][INFO][RK0][main]: Creating lookup session for dlrm on device: 1
worker 1 at process 35284
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
worker 0 at process 35283
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
worker 3 at process 35286
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
worker 2 at process 35285
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
0 time 9.01222e-08 0.00942786
0 time 4.00543e-08 0.00946978
0 time 8.7738e-08 0.0115061
0 time 8.7738e-08 0.011618
500 time 1.27902e-05 0.0603537
500 time 1.46971e-05 0.0665885
500 time 1.80845e-05 0.0667317
500 time 1.54762e-05 0.0669828
====================================================HPS Coll Create====================================================
====================================================HPS Coll Create====================================================
====================================================HPS Coll Create====================================================
====================================================HPS Coll Create====================================================
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
coll_cache:optimal_rep_storage=0.01
coll_cache:optimal_part_storage=0
coll_cache:optimal_cpu_storage=0.99
coll_cache:optimal_local_storage=0.01
coll_cache:optimal_remote_storage=0
coll_cache:optimal_local_rate=0.990863
coll_cache:optimal_remote_rate=0
coll_cache:optimal_cpu_rate=0.00913738
z=96.1747
test_result:init:feat_nbytes=451980587520
test_result:init:cache_nbytes=4519805440
1000 time 1.58329e-05 0.165196
1000 time 1.28198e-05 0.16532
1000 time 1.3483e-05 0.165249
1000 time 2.29783e-05 0.165244
1500 time 1.25995e-05 0.00239426
1500 time 1.22919e-05 0.00241868
1500 time 1.25947e-05 0.00250634
1500 time 1.23429e-05 0.00253167
2000 time 1.2167e-05 0.00245635
2000 time 1.24893e-05 0.00243034
2000 time 1.31054e-05 0.00254357
2000 time 1.38717e-05 0.00253853
2500 time 1.18775e-05 0.00248147
2500 time 1.25394e-05 0.00248677
2500 time 1.28713e-05 0.0024563
2500 time 1.27907e-05 0.00250322
    [Step(average) Profiler Level 1 E1 S3999]
        L1  sample           0.000000 | send           0.000000
        L1  recv             0.000000 | copy           0.000000 | convert time 0.000000 | train  0.002495
        L1  feature nbytes  104.00 MB | label nbytes 0.00 Bytes
        L1  id nbytes      0.00 Bytes | graph nbytes 0.00 Bytes
        L1  miss nbytes       2.97 MB | remote nbytes 0.00 Bytes
        L1  num nodes               0 | num samples           0
    [Step(average) Profiler Level 2 E1 S3999]
        L2  shuffle     0.000000 | core sample  0.000000 | id remap        0.000000
        L2  graph copy  0.000000 | id copy      0.000000 | cache feat copy 0.000546
        L2  last layer sample time 0.000000 | size 0.000000
    [Step(average) Profiler Level 3 E1 S3999]
        L3  khop sample coo  0.000000 | khop sort coo      0.000000 | khop count edge     0.000000 | khop compact edge 0.000000
        L3  walk sample coo  0.000000 | walk topk total    0.000000 | walk topk step1     0.000000 | walk topk step2   0.000000
        L3  walk topk step3  0.000000 | walk topk step4    0.000000 | walk topk step5     0.000000
        L3  walk topk step6  0.000000 | walk topk step7    0.000000
        L3  remap unique     0.000000 | remap populate     0.000000 | remap mapnode       0.000000 | remap mapedge     0.000000
        L3  cache get_index  0.000129 | cache copy_index   0.000000 | cache extract_miss  0.000000
        L3  cache copy_miss  0.000000 | cache combine_miss 0.000409 | cache combine cache 0.000272 | cache combine remote 0.000000
        L3  label extract  0.000000
