[INFO] hierarchical_parameter_server is imported
[INFO]: sparse_operation_kit is imported
config:eval_tsp="2022-12-11 18:26:42"
config:gpu_num=4
config:iter_num=3000
config:slot_num=26
config:embed_vec_size=128
config:dense_dim=13
config:global_batch_size=32768
config:iteration_per_epoch=1000
config:coll_cache_enable_iter=1000
config:coll_cache_policy=coll_asymm
config:embed_only=False
config:model=dlrm
config:combiner=mean
config:optimizer=plugin_adam
config:np_key_type=<class 'numpy.int32'>
config:np_vector_type=<class 'numpy.float32'>
config:tf_key_type=<dtype: 'int32'>
config:tf_vector_type=<dtype: 'float32'>
config:ps_config_file=run-configs/COLL_dlrm_CR_policy_CollAsymm_cache_rate_0.01_batch_size_32768_mock_882774585_128_concurrent_impl_MPS.json
config:dense_model_path=plain
config:dataset_path=/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
config:random_request=False
config:alpha=None
config:max_vocabulary_size=882774585
=====================================================HPS Parse====================================================
[HCTR][18:26:49.380][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:26:49.380][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:26:49.380][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:26:49.380][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:26:49.380][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:26:49.380][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:26:49.380][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:26:49.380][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:26:49.380][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:26:49.380][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:26:49.380][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:26:49.380][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:26:49.380][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:26:49.380][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:26:49.380][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:26:49.380][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:26:49.381][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:26:49.381][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:26:49.381][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:26:49.381][DEBUG][RK0][main]: Created raw model loader in local memory!
=====================================================HPS Parse====================================================
[HCTR][18:26:49.391][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:26:49.391][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:26:49.391][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:26:49.391][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:26:49.391][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:26:49.391][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:26:49.391][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:26:49.391][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:26:49.392][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:26:49.392][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:26:49.392][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:26:49.392][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:26:49.392][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:26:49.392][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:26:49.392][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:26:49.392][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:26:49.392][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:26:49.392][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:26:49.392][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:26:49.392][DEBUG][RK0][main]: Created raw model loader in local memory!
=====================================================HPS Parse====================================================
=====================================================HPS Parse====================================================
[HCTR][18:26:49.446][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:26:49.446][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:26:49.446][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:26:49.446][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:26:49.446][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:26:49.446][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:26:49.446][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:26:49.446][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:26:49.446][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:26:49.446][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:26:49.446][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:26:49.446][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:26:49.446][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:26:49.446][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:26:49.446][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:26:49.446][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:26:49.446][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:26:49.446][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:26:49.446][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:26:49.446][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:26:49.446][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:26:49.446][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:26:49.446][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:26:49.446][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:26:49.446][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:26:49.446][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:26:49.446][INFO][RK0][main]: refresh_interval is not specified using default: 0
[HCTR][18:26:49.446][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:26:49.446][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:26:49.446][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:26:49.447][INFO][RK0][main]: Creating DirectMap CPU database backend...
====================================================HPS Create====================================================
[HCTR][18:26:49.447][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:26:49.447][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:26:49.447][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:26:49.447][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:26:49.447][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:26:49.447][DEBUG][RK0][main]: Created raw model loader in local memory!
[HCTR][18:26:49.447][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:26:49.447][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:26:49.447][DEBUG][RK0][main]: Created raw model loader in local memory!
[HCTR][18:26:51.908][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:26:51.908][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:26:51.908][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:26:51.908][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:26:51.908][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:26:51.908][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:26:51.908][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:26:51.908][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:26:51.908][INFO][RK0][main]: Creating embedding cache in device 2.
[HCTR][18:26:51.908][INFO][RK0][main]: Creating embedding cache in device 3.
[HCTR][18:26:51.908][INFO][RK0][main]: Creating embedding cache in device 0.
[HCTR][18:26:51.908][INFO][RK0][main]: Creating embedding cache in device 1.
[HCTR][18:26:51.913][INFO][RK0][main]: Model name: dlrm
[HCTR][18:26:51.913][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:26:51.913][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:26:51.913][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:26:51.913][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:26:51.913][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:26:51.913][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:26:51.913][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:26:51.913][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:26:51.914][INFO][RK0][main]: Model name: dlrm
[HCTR][18:26:51.914][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:26:51.914][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:26:51.914][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:26:51.914][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:26:51.914][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:26:51.914][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:26:51.914][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:26:51.914][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:26:51.914][INFO][RK0][main]: Model name: dlrm
[HCTR][18:26:51.914][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:26:51.914][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:26:51.914][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:26:51.914][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:26:51.914][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:26:51.914][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:26:51.914][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:26:51.914][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:26:51.940][INFO][RK0][main]: Model name: dlrm
[HCTR][18:26:51.940][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:26:51.940][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:26:51.940][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:26:51.940][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:26:51.940][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:26:51.940][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:26:51.940][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:26:51.940][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:27:02.372][INFO][RK0][main]: Creating lookup session for dlrm on device: 1
[HCTR][18:27:02.382][INFO][RK0][main]: Creating lookup session for dlrm on device: 3
[HCTR][18:27:02.383][INFO][RK0][main]: Creating lookup session for dlrm on device: 2
[HCTR][18:27:02.390][INFO][RK0][main]: Creating lookup session for dlrm on device: 0
worker 0 at process 42568
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
worker 3 at process 42571
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
worker 2 at process 42570
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
worker 1 at process 42569
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
0 time 9.39369e-08 0.012557
0 time 8.01086e-08 0.0133681
0 time 4.19617e-08 0.0133683
0 time 8.58307e-08 0.0135695
500 time 1.60265e-05 0.0635251
500 time 5.01795e-05 0.0670732
500 time 0.00010295 0.0669685
500 time 1.93009e-05 0.0676963
====================================================HPS Coll Create====================================================
====================================================HPS Coll Create====================================================
====================================================HPS Coll Create====================================================
====================================================HPS Coll Create====================================================
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
Set parameter WLSAccessID
Set parameter WLSSecret
Set parameter LicenseID
Set parameter TimeLimit to value 200
Set parameter MIPGap to value 0.05
Set parameter GomoryPasses to value 0
Set parameter Aggregate to value 0
Set parameter LogFile to value "cppsolver.log"
Set parameter Threads to value 80
Academic license - for non-commercial use only - registered to xiaoniu.sxn@sjtu.edu.cn
Gurobi Optimizer version 9.5.1 build v9.5.1rc2 (linux64)
Thread count: 40 physical cores, 80 logical processors, using up to 80 threads
Academic license - for non-commercial use only - registered to xiaoniu.sxn@sjtu.edu.cn
Optimize a model with 52076 rows, 17022 columns and 140164 nonzeros
Model fingerprint: 0xeb4c2d0d
Variable types: 5 continuous, 17017 integer (17017 binary)
Coefficient statistics:
  Matrix range     [5e-05, 8e+02]
  Objective range  [1e+00, 1e+00]
  Bounds range     [1e+00, 1e+00]
  RHS range        [1e+00, 5e+01]
Found heuristic solution: objective 2.000000e+09
Presolve removed 36039 rows and 0 columns
Presolve time: 0.16s
Presolved: 16037 rows, 17022 columns, 65086 nonzeros
Found heuristic solution: objective 2342.8116485
Variable types: 5 continuous, 17017 integer (17017 binary)

Root relaxation: objective 8.453719e+01, 14279 iterations, 0.40 seconds (0.37 work units)

    Nodes    |    Current Node    |     Objective Bounds      |     Work
 Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time

     0     0   84.53719    0   47 2342.81165   84.53719  96.4%     -    0s
H    0     0                      90.6783711   84.53719  6.77%     -    1s
     0     0   85.62560    0   66   90.67837   85.62560  5.57%     -    2s
H    0     0                      88.0481712   85.62560  2.75%     -    3s

Cutting planes:
  MIR: 6

Explored 1 nodes (27864 simplex iterations) in 3.58 seconds (2.93 work units)
Thread count was 80 (of 80 available processors)

Solution count 4: 88.0482 90.6784 2342.81 2e+09 

Optimal solution found (tolerance 5.00e-02)
Best objective 8.804817115644e+01, best bound 8.562559893267e+01, gap 2.7514%
coll_cache:optimal_local_rate=0.911763,0.918998,0.909308,0.906337,
coll_cache:optimal_remote_rate=0.0754026,0.0681671,0.0778577,0.0808281,
coll_cache:optimal_cpu_rate=0.0128346,0.0128346,0.0128346,0.0128346,
z=88.0482
test_result:init:feat_nbytes=451980587520
test_result:init:cache_nbytes=4541049344
1000 time 2.55966e-05 0.339813
1000 time 1.49379e-05 0.339697
1000 time 2.91767e-05 0.33989
1000 time 4.36163e-05 0.339666
1500 time 1.29013e-05 0.00247319
1500 time 1.2743e-05 0.00250606
1500 time 1.33448e-05 0.00249763
1500 time 1.30806e-05 0.00249831
2000 time 1.34993e-05 0.00244766
2000 time 1.31378e-05 0.002472
2000 time 1.3267e-05 0.00245345
2000 time 1.36404e-05 0.00250307
2500 time 1.51644e-05 0.00262441
2500 time 1.50871e-05 0.00262294
2500 time 1.61042e-05 0.00261467
2500 time 1.50623e-05 0.00270336
    [Step(average) Profiler Level 1 E1 S3999]
        L1  sample           0.000000 | send           0.000000
        L1  recv             0.000000 | copy           0.000000 | convert time 0.000000 | train  0.002646
        L1  feature nbytes  104.00 MB | label nbytes 0.00 Bytes
        L1  id nbytes      0.00 Bytes | graph nbytes 0.00 Bytes
        L1  miss nbytes       2.75 MB | remote nbytes    6.19 MB
        L1  num nodes               0 | num samples           0
    [Step(average) Profiler Level 2 E1 S3999]
        L2  shuffle     0.000000 | core sample  0.000000 | id remap        0.000000
        L2  graph copy  0.000000 | id copy      0.000000 | cache feat copy 0.000552
        L2  last layer sample time 0.000000 | size 0.000000
    [Step(average) Profiler Level 3 E1 S3999]
        L3  khop sample coo  0.000000 | khop sort coo      0.000000 | khop count edge     0.000000 | khop compact edge 0.000000
        L3  walk sample coo  0.000000 | walk topk total    0.000000 | walk topk step1     0.000000 | walk topk step2   0.000000
        L3  walk topk step3  0.000000 | walk topk step4    0.000000 | walk topk step5     0.000000
        L3  walk topk step6  0.000000 | walk topk step7    0.000000
        L3  remap unique     0.000000 | remap populate     0.000000 | remap mapnode       0.000000 | remap mapedge     0.000000
        L3  cache get_index  0.000141 | cache copy_index   0.000000 | cache extract_miss  0.000000
        L3  cache copy_miss  0.000000 | cache combine_miss 0.000399 | cache combine cache 0.000261 | cache combine remote 0.000068
        L3  label extract  0.000000
