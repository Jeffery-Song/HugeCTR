[INFO] hierarchical_parameter_server is imported
[INFO]: sparse_operation_kit is imported
config:eval_tsp="2022-12-11 18:11:57"
config:gpu_num=4
config:iter_num=3000
config:slot_num=26
config:embed_vec_size=128
config:dense_dim=13
config:global_batch_size=32768
config:iteration_per_epoch=1000
config:coll_cache_enable_iter=1000
config:coll_cache_policy=cliq_part
config:embed_only=False
config:model=dlrm
config:combiner=mean
config:optimizer=plugin_adam
config:np_key_type=<class 'numpy.int32'>
config:np_vector_type=<class 'numpy.float32'>
config:tf_key_type=<dtype: 'int32'>
config:tf_vector_type=<dtype: 'float32'>
config:ps_config_file=run-configs/COLL_dlrm_CR_policy_CliqPart_cache_rate_0.01_batch_size_32768_mock_882774585_128_nogroup_DIRECT.json
config:dense_model_path=plain
config:dataset_path=/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
config:random_request=False
config:alpha=None
config:max_vocabulary_size=882774585
=====================================================HPS Parse====================================================
[HCTR][18:12:04.660][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:12:04.660][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:12:04.660][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:12:04.660][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:12:04.660][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:12:04.660][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:12:04.660][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:12:04.660][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:12:04.660][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:12:04.660][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:12:04.660][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:12:04.660][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:12:04.660][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:12:04.660][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:12:04.660][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:12:04.660][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:12:04.660][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:12:04.660][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:12:04.660][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:12:04.660][DEBUG][RK0][main]: Created raw model loader in local memory!
=====================================================HPS Parse====================================================
[HCTR][18:12:04.675][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:12:04.675][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:12:04.675][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:12:04.675][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:12:04.675][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:12:04.675][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:12:04.676][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:12:04.676][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:12:04.676][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:12:04.676][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:12:04.676][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:12:04.676][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:12:04.676][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:12:04.676][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:12:04.676][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:12:04.676][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:12:04.676][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:12:04.676][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:12:04.676][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:12:04.676][DEBUG][RK0][main]: Created raw model loader in local memory!
=====================================================HPS Parse====================================================
[HCTR][18:12:05.734][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:12:05.734][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:12:05.734][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:12:05.734][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:12:05.734][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:12:05.734][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:12:05.734][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:12:05.734][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:12:05.734][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:12:05.734][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:12:05.734][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:12:05.734][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:12:05.734][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:12:05.734][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:12:05.734][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:12:05.735][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:12:05.735][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:12:05.735][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:12:05.735][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:12:05.735][DEBUG][RK0][main]: Created raw model loader in local memory!
=====================================================HPS Parse====================================================
[HCTR][18:12:05.740][INFO][RK0][main]: address is not specified using default: 127.0.0.1:7000
[HCTR][18:12:05.740][INFO][RK0][main]: user_name is not specified using default: default
[HCTR][18:12:05.740][INFO][RK0][main]: password is not specified using default: 
[HCTR][18:12:05.740][INFO][RK0][main]: allocation_rate is not specified using default: 268435456
[HCTR][18:12:05.740][INFO][RK0][main]: max_get_batch_size is not specified using default: 10000
[HCTR][18:12:05.740][INFO][RK0][main]: max_set_batch_size is not specified using default: 10000
[HCTR][18:12:05.740][INFO][RK0][main]: refresh_time_after_fetch is not specified using default: 0
[HCTR][18:12:05.740][INFO][RK0][main]: overflow_margin is not specified using default: 18446744073709551615
[HCTR][18:12:05.740][INFO][RK0][main]: overflow_resolution_target is not specified using default: 0.8
[HCTR][18:12:05.740][INFO][RK0][main]: initial_cache_rate is not specified using default: 1
[HCTR][18:12:05.740][INFO][RK0][main]: cache_missed_embeddings is not specified using default: 0
[HCTR][18:12:05.740][INFO][RK0][main]: dense_file is not specified using default: 
[HCTR][18:12:05.740][INFO][RK0][main]: maxnum_des_feature_per_sample is not specified using default: 26
[HCTR][18:12:05.740][INFO][RK0][main]: refresh_delay is not specified using default: 0
[HCTR][18:12:05.740][INFO][RK0][main]: refresh_interval is not specified using default: 0
====================================================HPS Create====================================================
[HCTR][18:12:05.741][INFO][RK0][main]: Creating DirectMap CPU database backend...
[HCTR][18:12:05.741][DEBUG][RK0][main]: Created blank database backend in local memory!
[HCTR][18:12:05.741][INFO][RK0][main]: Volatile DB: initial cache rate = 1
[HCTR][18:12:05.741][INFO][RK0][main]: Volatile DB: cache missed embeddings = 0
[HCTR][18:12:05.741][DEBUG][RK0][main]: Created raw model loader in local memory!
[HCTR][18:12:07.026][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:12:07.026][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:12:07.026][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:12:07.026][INFO][RK0][main]: Table: hps_et.dlrm.sparse_embedding0; cached 882774585 / 882774585 embeddings in volatile database (DirectMapBackend); load: 882774585 / 18446744073709551615 (0.00%).
[HCTR][18:12:07.026][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:12:07.026][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:12:07.026][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:12:07.026][DEBUG][RK0][main]: Real-time subscribers created!
[HCTR][18:12:07.026][INFO][RK0][main]: Creating embedding cache in device 1.
[HCTR][18:12:07.026][INFO][RK0][main]: Creating embedding cache in device 2.
[HCTR][18:12:07.026][INFO][RK0][main]: Creating embedding cache in device 3.
[HCTR][18:12:07.026][INFO][RK0][main]: Creating embedding cache in device 0.
[HCTR][18:12:07.037][INFO][RK0][main]: Model name: dlrm
[HCTR][18:12:07.037][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:12:07.037][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:12:07.037][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:12:07.037][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:12:07.037][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:12:07.037][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:12:07.037][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:12:07.037][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:12:07.037][INFO][RK0][main]: Model name: dlrm
[HCTR][18:12:07.037][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:12:07.037][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:12:07.037][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:12:07.037][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:12:07.037][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:12:07.037][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:12:07.037][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:12:07.037][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:12:07.039][INFO][RK0][main]: Model name: dlrm
[HCTR][18:12:07.039][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:12:07.039][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:12:07.039][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:12:07.039][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:12:07.039][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:12:07.039][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:12:07.039][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:12:07.039][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:12:07.073][INFO][RK0][main]: Model name: dlrm
[HCTR][18:12:07.073][INFO][RK0][main]: Number of embedding tables: 1
[HCTR][18:12:07.074][INFO][RK0][main]: Use GPU embedding cache: True, cache size percentage: 0.010000
[HCTR][18:12:07.074][INFO][RK0][main]: Use I64 input key: False
[HCTR][18:12:07.074][INFO][RK0][main]: Configured cache hit rate threshold: 1.100000
[HCTR][18:12:07.074][INFO][RK0][main]: The size of thread pool: 80
[HCTR][18:12:07.074][INFO][RK0][main]: The size of worker memory pool: 1
[HCTR][18:12:07.074][INFO][RK0][main]: The size of refresh memory pool: 0
[HCTR][18:12:07.074][INFO][RK0][main]: The refresh percentage : 0.000000
[HCTR][18:12:44.965][INFO][RK0][main]: Creating lookup session for dlrm on device: 1
[HCTR][18:12:44.970][INFO][RK0][main]: Creating lookup session for dlrm on device: 0
[HCTR][18:12:44.982][INFO][RK0][main]: Creating lookup session for dlrm on device: 3
[HCTR][18:12:44.997][INFO][RK0][main]: Creating lookup session for dlrm on device: 2
worker 2 at process 13156
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
worker 3 at process 13157
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
worker 0 at process 13154
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
worker 1 at process 13155
/nvme/songxiaoniu/hps-dataset/criteo_tb/saved_dataset
loading criteo
load criteo from  /nvme/songxiaoniu/criteo-TB/processed/day_6.sparse
(204846845, 26)
0 time 8.44002e-08 0.0122185
0 time 9.20296e-08 0.0122723
0 time 4.43459e-08 0.0122933
0 time 3.76701e-08 0.012329
500 time 1.26629e-05 0.0564759
500 time 4.21262e-05 0.0637791
500 time 1.29004e-05 0.0653832
500 time 1.29747e-05 0.0662318
====================================================HPS Coll Create====================================================
====================================================HPS Coll Create====================================================
====================================================HPS Coll Create====================================================
====================================================HPS Coll Create====================================================
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
0 :  {link #0 : 1}, {link #1 : 2}, {link #2 : 3},
1 :  {link #0 : 2}, {link #1 : 3}, {link #2 : 0},
2 :  {link #0 : 3}, {link #1 : 0}, {link #2 : 1},
3 :  {link #0 : 0}, {link #1 : 1}, {link #2 : 2},
coll_cache:optimal_rep_storage=0
coll_cache:optimal_part_storage=0.04
coll_cache:optimal_cpu_storage=0.96
coll_cache:optimal_local_storage=0.01
coll_cache:optimal_remote_storage=0.03
coll_cache:optimal_local_rate=0.25
coll_cache:optimal_remote_rate=0.75
coll_cache:optimal_cpu_rate=0
z=515.03,515.03,515.03,515.03,
1000 time 1.29876e-05 0.194969
1000 time 1.30591e-05 0.195063
1000 time 1.28698e-05 0.195137
1000 time 3.70874e-05 0.195317
1500 time 1.49822e-05 0.0047594
1500 time 1.44439e-05 0.00478649
1500 time 1.49765e-05 0.00475735
1500 time 1.44625e-05 0.00478183
2000 time 1.46332e-05 0.00475496
2000 time 1.47095e-05 0.0047218
2000 time 1.44835e-05 0.00475735
2000 time 1.46551e-05 0.00474939
2500 time 1.45168e-05 0.00479202
2500 time 1.50843e-05 0.00480195
2500 time 1.43905e-05 0.00479037
2500 time 1.51482e-05 0.00479124
test_result:init:feat_nbytes=451980587520
test_result:init:cache_nbytes=4565003264
    [Step(average) Profiler Level 1 E1 S3999]
        L1  sample           0.000000 | send           0.000000
        L1  recv             0.000000 | copy           0.000000 | convert time 0.000000 | train  0.004822
        L1  feature nbytes  104.00 MB | label nbytes 0.00 Bytes
        L1  id nbytes      0.00 Bytes | graph nbytes 0.00 Bytes
        L1  miss nbytes    0.00 Bytes | remote nbytes 0.00 Bytes
        L1  num nodes               0 | num samples           0
    [Step(average) Profiler Level 2 E1 S3999]
        L2  shuffle     0.000000 | core sample  0.000000 | id remap        0.000000
        L2  graph copy  0.000000 | id copy      0.000000 | cache feat copy 0.001370
        L2  last layer sample time 0.000000 | size 0.000000
    [Step(average) Profiler Level 3 E1 S3999]
        L3  khop sample coo  0.000000 | khop sort coo      0.000000 | khop count edge     0.000000 | khop compact edge 0.000000
        L3  walk sample coo  0.000000 | walk topk total    0.000000 | walk topk step1     0.000000 | walk topk step2   0.000000
        L3  walk topk step3  0.000000 | walk topk step4    0.000000 | walk topk step5     0.000000
        L3  walk topk step6  0.000000 | walk topk step7    0.000000
        L3  remap unique     0.000000 | remap populate     0.000000 | remap mapnode       0.000000 | remap mapedge     0.000000
        L3  cache get_index  0.000000 | cache copy_index   0.000000 | cache extract_miss  0.000000
        L3  cache copy_miss  0.000000 | cache combine_miss 0.000000 | cache combine cache 0.001368 | cache combine remote 0.000000
        L3  label extract  0.000000
